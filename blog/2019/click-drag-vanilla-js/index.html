
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Implementing Click &amp; Drag with Vanilla JS &#8212; Alex Carney</title>

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    
    
    
    <link rel="stylesheet" type="text/css" href="../../../_static/css/styles.css" />
    
    
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../../../_static/pygments_dark.css" />
    

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
  </head><body class="flex flex-col justify-between min-h-screen overflow-x-hidden bg-gray-100 dark:bg-gray-900">
    <div class="flex flex-grow">
        <input id="menu-state" type="checkbox" class="hidden" />
        <aside class="flex justify-between flex-shrink-0 transition-all duration-500 bg-white dark:bg-gray-800 -ml-80 lg:ml-0 dark:border-gray-600">
            <div class="flex flex-col justify-between h-full border-r w-80 dark:border-gray-600">
                <div class="sticky top-0 flex flex-col h-screen">

                    <div id="profile-card" class="full-profile">
    <img class="" src="/_static/avatar.jpg"/>
    <h2 class=""><a href="/">Alex Carney</a></h2>
</div>

                    <div id="searchbox" style="display: none" role="search" class="px-4 py-4">
    <form class="flex justify-between px-2 py-1 bg-gray-100 border-2 rounded search dark:bg-gray-900 focus-within:border-green-600 dark:border-gray-600" action="../../../search/" method="get">
        <label class="mr-2 text-gray-500" for="sbox">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
                <circle cx="11" cy="11" r="6" />
                <path d="m21 21-4.35-4.35" />
            </svg>
        </label>
        <input id="sbox" class="flex-grow bg-gray-100 dark:text-white dark:bg-gray-900 focus:outline-none" type="search" name="q" placeholder="Search..." aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </form>
</div>
<script>$('#searchbox').show(0);</script>

                    

<nav class="flex flex-col text-center">
    <a class="text-green-600 py-1 border-t text-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-900" href="/blog">Blog</a>
    <a class="text-green-600 py-1 border-t text-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-900" href="/code">Code</a>
    <a class="text-green-600 py-1 border-t text-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-900" href="/notes">Notes</a>
</nav>

                    <div class="flex-shrink overflow-auto">

<div class="grid justify-between p-4 text-gray-400 border-t dark:border-gray-600" style="grid-template-columns: 24px auto">
    
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
    <span class="ml-2 text-right">Jul 07, 2019</span>
    

    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
</svg>
    <ul class="text-right">
        
        <li class="mb-1">
            <a href="../../tag/js/" class="px-2 my-1 text-green-600 border border-green-600 rounded bg-green-50 dark:bg-green-900 dark:text-green-200">
                #js
            </a>
        </li>
        
        <li class="mb-1">
            <a href="../../tag/svg/" class="px-2 my-1 text-green-600 border border-green-600 rounded bg-green-50 dark:bg-green-900 dark:text-green-200">
                #svg
            </a>
        </li>
        
        <li class="mb-1">
            <a href="../../tag/web/" class="px-2 my-1 text-green-600 border border-green-600 rounded bg-green-50 dark:bg-green-900 dark:text-green-200">
                #web
            </a>
        </li>
        
    </ul>
</div>
<nav id="localtoc" class="p-4 border-t dark:text-gray-200 dark:border-gray-600">
    <ul>
<li><a class="reference internal" href="#">Implementing Click &amp; Drag with Vanilla JS</a><ul>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#the-view-box">The View Box</a></li>
<li><a class="reference internal" href="#something-to-click-on">Something to Click on</a></li>
<li><a class="reference internal" href="#implementing-the-drag">Implementing the Drag</a><ul>
<li><a class="reference internal" href="#not-clicked">Not Clicked</a></li>
<li><a class="reference internal" href="#clicked">Clicked</a></li>
</ul>
</li>
<li><a class="reference internal" href="#click-detection">Click Detection</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

</nav>
                    </div>

                    <footer class="w-full p-4 mt-auto text-white bg-gray-700">
                        <div class="flex justify-between">
    <div></div>

    <div class="flex justify-between space-x-4">
        <a target="_blank" rel="noreferrer noopener" href="https://github.com/alcarney">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
            <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
          </svg>
        </a>

        <a target="_blank" rel="noreferrer noopener me" href="https://fosstodon.org/@alcarney">
          <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="currentColor">
            <title>Mastodon</title>
            <path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/>
          </svg>
        </a>

        <a target="_blank" rel="noreferrer noopener" href="https://instagram.com/alcarneyme">
          <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="currentColor">
            <title>Instagram</title>
            <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"/>
          </svg>
        </a>

        <a target="_blank" rel="noreferrer noopener" href="https://www.youtube.com/channel/UC5GPflgRWhnCxA0BllfP5CA">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 h-8" fill="currentColor">
            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
          </svg>
        </a>
    </div>

    <div></div>
</div>
                    </footer>
                </div>
            </div>
        </aside>

        <main class="w-full mx-auto lg:pr-0">
            <div class="sticky top-0 z-50 mt-0 transition-all duration-300 bg-white dark:bg-gray-800 border-b shadow-md lg:shadow-none lg:relative lg:-mt-16 dark:border-gray-600">
                <label class="flex h-16 text-gray-600 transition" for="menu-state">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 h-8 my-auto" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </label>
            </div>

            <div id="content" class="mx-2 my-8">
                <div role="main" class="max-w-3xl mx-auto">
                    

<article class="p-4 prose-sm prose bg-white dark:bg-gray-800 border prose-md prose-emerald max-w-none dark:prose-invert dark:border-gray-600">
    <section id="implementing-click-drag-with-vanilla-js">
<h1>Implementing Click &amp; Drag with Vanilla JS<a class="headerlink" href="#implementing-click-drag-with-vanilla-js" title="Permalink to this heading">¶</a></h1>
<figure>
  <div id="main"></div>
  <figcaption>
    <p>Try clicking and dragging on this circle.</p>
  </figcaption>
</figure>
<script type="text/javascript" src="/_static/js/click-drag.js"></script><div class="admonition-disclaimer admonition">
<p class="admonition-title">Disclaimer</p>
<p>This post makes use of a number of interactive elements to help illustrate a few
concepts. Unfortunately these do not yet work on mobile devices - sorry mobile
users!</p>
</div>
<p>I have for quite some time now wanted to play around with web development some
more, particularly using web technologies to build user interfaces of some
kind. However there is just <strong>so much</strong> out there it’s been impossible for me to
really get anywhere past a “Hello, World!” tutorial before I find myself trying
out the next new shiny.</p>
<p>So I’ve decided to abandon everything and try a bottom up approach where I see
how far I can push the core web technologies - HTML, CSS and
JavaScript. Hopefully then by the time I start using one of the gazillion
libraries out there I will have a better understanding of why I
needed it in the first place.</p>
<p>In this post I will be looking at implementing clicking and dragging
functionality using only vanilla JavaScript. Clicking and dragging as a concept
can apply to many kinds of interactions so in this instance I’m specifically
referring to clicking on an SVG element moving it around on the page as
illustrated by the demo above.</p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¶</a></h2>
<p>All we need to get started is a HTML document that contains some markup which
provides someplace we can reference and attach our image element to, as well as
loading the code we write.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/js/click-drag.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Then the first step is to create our SVG image element to act as our “canvas”
that we can draw on.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">svgns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http://www.w3.org/2000/svg&quot;</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">)</span><span class="w"></span>

<span class="kd">const</span><span class="w"> </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElementNS</span><span class="p">(</span><span class="nx">svgns</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;svg&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nx">canvas</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;100%&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nx">canvas</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;100%&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;solid 2px #242930&quot;</span><span class="w"></span>

<span class="nx">main</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>A few things to note:</p>
<ul class="simple">
<li><p>By adding our <code class="docutils literal notranslate"><span class="pre">&lt;svg&gt;</span></code> element as a child of some <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> element and setting
both the <code class="docutils literal notranslate"><span class="pre">width</span></code> and <code class="docutils literal notranslate"><span class="pre">height</span></code> to <code class="docutils literal notranslate"><span class="pre">100%</span></code> our canvas will be able to
scale responsively based on the styles applied to the parent <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code></p></li>
<li><p>You might already be familiar with the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement">document.createElement()</a> function for
creating HTML elements using JavaScript. However in order to work with SVG
elements we need to use the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElementNS">document.createElementNS()</a> function which allows
us to use the SVG namespace instead of the HTML default.</p></li>
</ul>
</section>
<section id="the-view-box">
<h2>The View Box<a class="headerlink" href="#the-view-box" title="Permalink to this heading">¶</a></h2>
<p>The next step is to construct an appropriate <code class="docutils literal notranslate"><span class="pre">viewBox</span></code> definition for our
canvas. For more information on the <code class="docutils literal notranslate"><span class="pre">viewBox</span></code> you can refer to the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox">documentation</a>
but to briefly summarise. An SVG image exists on an infinite plane and the
<code class="docutils literal notranslate"><span class="pre">viewBox</span></code> is the window we use to view a portion of that space, changing the
definition of the <code class="docutils literal notranslate"><span class="pre">viewBox</span></code> allows you to zoom in and out on particular regions.</p>
<p>For our purposes what’s important is that we construct a <code class="docutils literal notranslate"><span class="pre">viewBox</span></code> that matches
the proportions of the <code class="docutils literal notranslate"><span class="pre">&lt;svg&gt;</span></code> element as it is displayed in the browser. If
these proportions do not match then the element being dragged around will not
accurately track the cursor, either racing away from or lagging behind it.</p>
<p>One minor issue is that in our setup we didn’t explicitly set the dimensions of
our <code class="docutils literal notranslate"><span class="pre">&lt;svg&gt;</span></code> element - so how can we know its proportions? Thankfully once the
<code class="docutils literal notranslate"><span class="pre">&lt;svg&gt;</span></code> as been added to the page we can ask the browser for the bounding box
around the element.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">()</span><span class="w"></span>
</pre></div>
</div>
<p>Among other properties that are outlined on <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect">this</a> page we can get the width and
height of the rendered image in pixels from which its easy to calculate the
aspect ratio.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">aspectRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">height</span><span class="w"></span>
</pre></div>
</div>
<p>We’re free to choose whichever scale we want for the vertical height of the
<code class="docutils literal notranslate"><span class="pre">viewBox</span></code> into the <code class="docutils literal notranslate"><span class="pre">&lt;svg&gt;</span></code> element. I have chosen <code class="docutils literal notranslate"><span class="pre">100</span></code> simply because it feels
like a nice round number. Once we’ve decided on a scale for the height, it’s
easy enough to calculate the corresponding width from our aspect ratio.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">aspectRatio</span><span class="w"></span>
</pre></div>
</div>
<p>With the dimensions of the <code class="docutils literal notranslate"><span class="pre">viewBox</span></code> taken care of all that is left to do is
decide on the coordinates to assign to the top left corner of the <code class="docutils literal notranslate"><span class="pre">&lt;svg&gt;</span></code>
element and assign the view box to our canvas.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">viewBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">minX</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">minY</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="o">:</span><span class="w"> </span><span class="nx">height</span><span class="p">}</span><span class="w"></span>

<span class="kd">const</span><span class="w"> </span><span class="nx">viewBoxStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">  </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">minX</span><span class="p">,</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">minY</span><span class="p">,</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">height</span><span class="w"></span>
<span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="w"></span>

<span class="nx">canvas</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;viewBox&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">viewBoxStr</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="something-to-click-on">
<h2>Something to Click on<a class="headerlink" href="#something-to-click-on" title="Permalink to this heading">¶</a></h2>
<p>By this point we have finished preparing our canvas and it’s time to add
something for us to interact with. To keep things simple I will stick to a <code class="docutils literal notranslate"><span class="pre">&lt;circle&gt;</span></code>
element, though the method we use here should apply to any SVG element (or any
collection of elements under a <code class="docutils literal notranslate"><span class="pre">&lt;g&gt;</span></code> tag).</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">circle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElementNS</span><span class="p">(</span><span class="nx">svgns</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;circle&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"></span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"></span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">15</span><span class="p">)</span><span class="w"></span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;#57cc8a&quot;</span><span class="p">)</span><span class="w"></span>

<span class="nx">canvas</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">circle</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Of course the way in which you define the position of your interactive element
will depend on the element you have chosen.</p>
</div>
</section>
<section id="implementing-the-drag">
<h2>Implementing the Drag<a class="headerlink" href="#implementing-the-drag" title="Permalink to this heading">¶</a></h2>
<p>We will create an event handler for the <code class="docutils literal notranslate"><span class="pre">mousemove</span></code> event and attach it to
our canvas.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mousemove&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Do something clever here...</span><span class="w"></span>
<span class="p">})</span><span class="w"></span>
</pre></div>
</div>
<p>The function we write will be called every time the cursor moves regardless of
whether the user has clicked or not. This means our event handler has to be able
to cope with two situations, the cursor moving when the user has clicked and the
cursor moving when the user has not clicked.</p>
<p>To do this we will declare a variable called <code class="docutils literal notranslate"><span class="pre">clicked</span></code> outside the scope of our
function.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">clicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
</pre></div>
</div>
<p>For the moment we will ignore the details around how this variable is updated
(it is covered in the next section), instead let’s focus on what we do while the
cursor is moving about the page</p>
<p>Let’s get the simpler case out of the way first</p>
<section id="not-clicked">
<h3>Not Clicked<a class="headerlink" href="#not-clicked" title="Permalink to this heading">¶</a></h3>
<p>When the mouse is moving but the user has not clicked, then there is nothing for
us to do! We can simply check the value of the <code class="docutils literal notranslate"><span class="pre">clicked</span></code> variable and stop the
function if it meets the criteria.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">clicked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="clicked">
<h3>Clicked<a class="headerlink" href="#clicked" title="Permalink to this heading">¶</a></h3>
<p>Now for the interesting part! The mouse is moving and the user has clicked on
the circle, all we have to do now is update its position to match
the cursor’s current position. The only problem is… where is it?</p>
<p>Like all mouse related events the <code class="docutils literal notranslate"><span class="pre">event</span></code> object passed into the event handler
will contain a number of position related properties.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">e.client&lt;XY&gt;</span></code>: Coordinates of the cursor with respect to the current portion
of the document visible on the page.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e.offset&lt;XY&gt;</span></code>: Coordinates of the cursor with respect to the edge of the
target element</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e.page&lt;XY&gt;</span></code>: Coordinates of the cursor with respect to the entire HTML page,
including any portions of the page not currently visible</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e.screen&lt;XY&gt;</span></code>: Coordinates of the cursor with respect to the user’s display</p></li>
</ul>
<p>Reading through those descriptions you would imagine that the <code class="docutils literal notranslate"><span class="pre">e.offset&lt;XY&gt;</span></code>
properties would be the best fit for our use case. However it’s not quite as
simple as that.</p>
<p>Below you should see 2 boxes, the bigger one on the left is our canvas. The
smaller box on the right contains a smaller circle that represents the
calculated position of the cursor based on the <code class="docutils literal notranslate"><span class="pre">offset&lt;XY&gt;</span></code> properties like so.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">offsetX</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">offsetY</span><span class="w"></span>
</pre></div>
</div>
<p>Try moving the mouse across the canvas and keep an eye on the calculated
position.</p>
<figure>
  <div id="offset-demo"
       style="display:grid;grid-template-columns:50% auto;grid-gap:10px">
  <h3 id="offset-title" style="margin: 0; padding: 15px; padding-top: 0">
    Cursor Position: Offset
  </h3>
    <div>
      <p style="margin:0;padding-left:20px">Target: <span id="offset-target"></span></p>
      <p style="margin:0;padding-left:20px">Position: <span id="offset-position"></span></p>
    </div>
    <svg width="100%"
         id="offset-demo-canvas"
         style="border: solid 2px var(--background-dark)">
    </svg>
    <svg width="50%"
         id="offset-posbox"
         style="border: solid 2px var(--background-dark);margin:auto"><svg>
  </div>
  <figcaption>
    <p>
      Determining the cursor's position using the <code>event.offsetX</code> and
      <code>event.offsetY</code> properties
    </p>
  </figcaption>
</figure>
<script type="text/javascript" src="/_static/js/click-drag-offset.js"></script><p>Notice the issue when we move across the circle? Why does the calculated
position of the cursor suddenly jump whenever we touch it? The answer lies in
the description of the <code class="docutils literal notranslate"><span class="pre">offset&lt;XY&gt;</span></code> property “with respect to the edge of the
<strong>target</strong> element”</p>
<p>When initially trying to implement this I incorrectly assumed that the target
element meant the element that we attached the event listener to - the canvas. In
fact the target element is whichever element is currently under the cursor</p>
<p>To work around this we can calculate the offset values we need ourselves. In
order to do this we will make use of both the bounding box returned from the
<code class="docutils literal notranslate"><span class="pre">canvas.getBoundingClientRect()</span></code> method as well as the <code class="docutils literal notranslate"><span class="pre">client&lt;XY&gt;</span></code> properties
found on the mouse event.</p>
<p>It turns out that the bounding box also returns the coordinates of the top left
corner of the canvas relative to the user’s current view of the document -
exactly the same coordinate system used by the <code class="docutils literal notranslate"><span class="pre">client&lt;XY&gt;</span></code> properties! From
those two pieces of information it’s easy enough to recover the <code class="docutils literal notranslate"><span class="pre">offset&lt;XY&gt;</span></code>
values ourselves.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">()</span><span class="w"></span>

<span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">left</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">top</span><span class="w"></span>
</pre></div>
</div>
<p>By calculating the coordinates using values that are independent of the element
currently underneath the cursor we sidestep any issues that arise from a
changing target. Try the same thing again on the canvas below.</p>
<figure>
<div id="client-demo"
      style="display:grid;grid-template-columns:50% auto;grid-gap:10px">
   <h3 id="offset-title" style="margin: 0; padding: 15px; padding-top: 0">
      Cursor Position: Client
   </h3>
   <div>
      <p style="margin:0;padding-left:20px">Target: <span id="client-target"></span></p>
      <p style="margin:0;padding-left:20px">Position: <span id="client-position"></span></p>
   </div>
   <svg width="100%"
         id="client-demo-canvas"
         style="border: solid 2px var(--background-dark)">
   </svg>
      <svg width="50%"
         id="client-posbox"
         style="border: solid 2px var(--background-dark);margin:auto"><svg>
</div>
<figcaption>
   <p>
      Determining the cursor's position using the <code>event.clientX</code> and
      <code>event.clientY</code> properties
   </p>
</figcaption>
</figure>
<script type="text/javascript" src="/_static/js/click-drag-client.js"></script><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Since the values <code class="docutils literal notranslate"><span class="pre">bbox.top</span></code> and <code class="docutils literal notranslate"><span class="pre">bbox.left</span></code> are defined relative to the user’s
current view on the document these values are <strong>not</strong> constant. They will change
whenever the user alters their view of the page, i.e. performing actions like
resizing the window or scrolling. This is why we ask for an updated bounding box
every time our event handler is called.</p>
</div>
<p>Now that we can reliably know the position of the cursor, we can focus on the
final piece of this puzzle - updating the position of our <code class="docutils literal notranslate"><span class="pre">&lt;circle&gt;</span></code>
element. There is however one further issue to work through. The position of the
cursor that we’ve just calculated is using a different coordinate system to the
one used to draw our circle!</p>
<p>Although we have managed to correctly calculate the cursor’s position relative
to our canvas, that position is measured using pixels which makes it highly
dependent on the resolution of the user’s screen. A user who uses a 4K monitor
and positions their cursor at the bottom right of the canvas will have a
calculated position much larger than a user on a smartphone…</p>
<p>What this means is that if we map this calculated position directly onto the
circle it won’t accurately follow the cursor. The only time the circle would
follow the cursor correctly is when the pixel based coordinates line up with the
coordinate system used in the SVG image. I.e. when the dimensions of the canvas
match up <strong>exactly</strong> with the scale used to define our <cite>viewBox</cite> which in this
case would be <code class="docutils literal notranslate"><span class="pre">100px</span></code> tall</p>
<p>Since the mouse circle and the circle use different coordinate systems, we don’t
actually care about the exact position we have just calculated. What’s more
important is the position of the cursor relative to bounds of the canvas - a
percentage. For example, let’s say that the cursor was halfway down the canvas
(<code class="docutils literal notranslate"><span class="pre">50%</span></code>) then we could calculate the corresponding coordinate value in the SVG
coordinate system by multiplying the total height by <code class="docutils literal notranslate"><span class="pre">50%</span></code>. In our particular
case this would mean setting <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">100</span> <span class="pre">*</span> <span class="pre">0.5</span> <span class="pre">=</span> <span class="pre">50</span></code>.</p>
<p>We can adopt this approach by using the <cite>width</cite> and <cite>height</cite> information
returned as part of the bounding box to modify our calculation to produce a
percentage rather than an absolute value.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">width</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">height</span><span class="w"></span>
</pre></div>
</div>
<p>To then convert this percentage into its corresponding value in the SVG
coordinate system all we have to do is multiply it by the width and height of
that system and assign the result to our circle’s position!</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">circle</span><span class="p">.</span><span class="nx">setAttriubte</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span><span class="w"></span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Bringing all that together we end up with the following implementation of our
<code class="docutils literal notranslate"><span class="pre">mousemove</span></code> event handler.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mousemove&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">clicked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="nx">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">()</span><span class="w"></span>

<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">width</span><span class="w"></span>
<span class="w">   </span><span class="kd">const</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">bbox</span><span class="p">.</span><span class="nx">height</span><span class="w"></span>

<span class="w">   </span><span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span><span class="w"></span>
<span class="p">})</span><span class="w"></span>
</pre></div>
</div>
<p>Nearly there! The only thing left to do is decide on how we want to update the
<code class="docutils literal notranslate"><span class="pre">clicked</span></code> variable.</p>
</section>
</section>
<section id="click-detection">
<h2>Click Detection<a class="headerlink" href="#click-detection" title="Permalink to this heading">¶</a></h2>
<p>Finally all that’s left is to do is decide how we want to toggle the dragging
behaviour. This mostly comes down to how you want the user to interact with the
draggable object and will change depending on your use case. To keep things
simple I will go with a fairly simple interaction model</p>
<ul class="simple">
<li><p>If the mouse is over the circle and the user clicks then start dragging</p></li>
<li><p>If the user releases the mouse button then stop dragging</p></li>
</ul>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">circle</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mousedown&quot;</span><span class="p">,</span><span class="w">  </span><span class="p">(</span><span class="nx">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">clicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mouseup&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">clicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</pre></div>
</div>
<p>Additionally I will impose one final condition</p>
<ul class="simple">
<li><p>If the mouse leaves the bounds of the canvas then stop dragging.</p></li>
</ul>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;mouseleave&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">clicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</pre></div>
</div>
<p>This last point is to work around an issue that arises when the user moves the
cursor out of the bounds of the canvas and releases the mouse button. Since the
cursor is no longer over the circle the handler for the <code class="docutils literal notranslate"><span class="pre">mouseup</span></code> event on the
circle is never fired so when the user brings their cursor back over the canvas
our code still believes the user never released the mouse button and so the
circle will appear “stuck” to their cursor until they click again.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>There you have it, those were some of the basics required to get a working proof
of concept of clicking and dragging functionality using only the JavaScript APIs
that come with your web browser. However in writing this blog post I realised
as with anything that the rabbit hole goes deep and there are many
considerations to keep in mind if you wanted to “productionise” this code for
any real usage.</p>
<ul>
<li><p><strong>Touchscreen Support</strong></p>
<p>If you were reading this post on a mobile device you will already have noticed
that none of the interactive demos have worked. This is because touchscreens
have their own family of <code class="docutils literal notranslate"><span class="pre">touchXXXX</span></code> events that are triggered when a user
interacts with a webpage. While there is some mouse emulation done by the
browsers (e.g. a <cite>touchstart</cite> event will trigger a <code class="docutils literal notranslate"><span class="pre">mousedown</span></code> event if not
handled), some key events such as <cite>mousemove</cite> are not emulated and require
dedicated support in your code. See <a class="reference external" href="https://www.html5rocks.com/en/mobile/touch/">these</a> <a class="reference external" href="https://www.html5rocks.com/en/mobile/touchandmouse/">articles</a> for more details</p>
</li>
<li><p><strong>Snap to Center</strong></p>
<p>This is only a minor issue and depending on your use case may not be a problem
at all. Currently whenever you pick up the circle its center snaps to the
cursor’s position. There may be situations where you would prefer the keep the
object’s relative position to the cursor e.g. fine adjustments, the last thing
you would want is for the object to jump to the cursor just because the user
happened to click on it off center.</p>
<p>A way around this would be to record the original positions of both the mouse
cursor and the object on a click, then on each <code class="docutils literal notranslate"><span class="pre">mousemove</span></code> event calculate the
distance moved by the cursor and apply it to the original recorded position of
the object.</p>
</li>
<li><p><strong>Multiple Objects</strong></p>
<p>Chances are when using this functionality in a real application you would want
the ability to click and drag on multiple objects. Adding support for this
would require reworking at least some of the code, having the canvas object
handle all mouse movements is probably a good idea but of course updating the
circle’s position directly would have to change. It would probably make sense
to move the click detection logic onto the canvas also, making use of the
<code class="docutils literal notranslate"><span class="pre">event.target</span></code> property to determine which object would need updating.</p>
</li>
<li><p><strong>Canvas Resizing</strong></p>
<p>While the existing code makes some effort to ensure this works in a responsive
manner it is currently only “statically responsive”. What I mean is that on
page load all the necessary calculations are performed to ensure that the
<code class="docutils literal notranslate"><span class="pre">viewBox</span></code> has the correct proportions for example. However if the user were to
resize the webpage, or rotate their device chances are the proportions of the
canvas would change meaning that the circle would no longer follow the cursor
correctly.</p>
<p>In order to be truly responsive, we would need to listen for events such as
<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/resize%5Fevent">resize</a> and perform all the calculations again.</p>
</li>
<li><p><strong>Pan and Zoom</strong></p>
<p>Something I realised when writing up the part where we map the cursor’s
position onto the position of the circle is that I had by chance chosen a
special case where the maths is a little easier. The calculations
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">*</span> <span class="pre">viewBox.width</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">*</span> <span class="pre">viewBox.height</span></code> only work because our <code class="docutils literal notranslate"><span class="pre">viewBox</span></code> starts
at <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0)</span></code>.</p>
<p>Say we had an application that also allowed for panning and zooming of the
canvas itself then the chances are our <code class="docutils literal notranslate"><span class="pre">viewBox</span></code> would not be starting at
<code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0)</span></code> and we would have to include an offset in our calculations to reflect
this. This means for the general case our code should probably look something
like this</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">minX</span><span class="p">)</span><span class="w"></span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">viewBox</span><span class="p">.</span><span class="nx">minY</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<p>I’m sure there are more edge cases and considerations to think of but this post
is long enough already! - Perhaps this is why people use libraries for this kind
of thing 🤔…</p>
<p>I will leave you with the final version of the code that went into the demo you
saw at the start of this blog post so you can see it all in context. Hopefully
you found this useful and I’ll see you in the next one!</p>
</section>
</section>

</article>




<div class="mt-8 pt-4 border-t dark:border-gray-600">
    <script src="https://giscus.app/client.js"
            data-repo="alcarney/blog"
            data-repo-id="MDEwOlJlcG9zaXRvcnk2Njk3NzM3MQ=="
            data-category="Comments"
            data-category-id="DIC_kwDOA_3-W84B_XOl"
            data-mapping="pathname"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-theme="preferred_color_scheme"
            crossorigin="anonymous"
            async>
    </script>
</div>



                </div>
            </div>

            <footer class="p-2 mt-8 mb-2 text-sm text-gray-600 border-t dark:border-gray-600">
                <div class="flex flex-col justify-between max-w-3xl mx-auto lg:flex-row">
                    <span>
                        <a class="text-green-600" href="../../../_sources/blog/2019/click-drag-vanilla-js.rst.txt" rel="nofollow">
                            Page Source
                        </a>
                    </span>
                    <span>Built with <a class="text-green-600" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> v5.1.1</span>
                    <span>&#169; Copyright 1980, Alex Carney.</span>
                </div>
            </footer>
        </main>

    </div>
<script src="/_static/js/theme.js"></script>


  </body>
</html>