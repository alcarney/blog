
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Learning Vulkan: Enumerating Physical Devices &#8212; Blog  documentation</title>

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    
    
    
    <link rel="stylesheet" type="text/css" href="../../../_static/css/styles.css" />
    
    
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../../../_static/pygments_dark.css" />
    

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
  </head><body class="flex flex-col justify-between min-h-screen overflow-x-hidden bg-gray-100 dark:bg-gray-900">
    <div class="flex flex-grow">
        <input id="menu-state" type="checkbox" class="hidden" />
        <aside class="flex justify-between flex-shrink-0 transition-all duration-500 bg-white dark:bg-gray-800 -ml-80 lg:ml-0 dark:border-gray-600">
            <div class="flex flex-col justify-between h-full border-r w-80 dark:border-gray-600">
                <div class="sticky top-0 flex flex-col h-screen">

                    <div id="profile-card" class="full-profile">
    <img class="" src="https://github.com/alcarney.png"/>
    <h2 class=""><a href="/">Alex Carney</a></h2>
</div>

                    <div id="searchbox" style="display: none" role="search" class="px-4 py-4">
    <form class="flex justify-between px-2 py-1 bg-gray-100 border-2 rounded search dark:bg-gray-900 focus-within:border-green-600 dark:border-gray-600" action="../../../search/" method="get">
        <label class="mr-2 text-gray-500" for="sbox">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
                <circle cx="11" cy="11" r="6" />
                <path d="m21 21-4.35-4.35" />
            </svg>
        </label>
        <input id="sbox" class="flex-grow bg-gray-100 dark:text-white dark:bg-gray-900 focus:outline-none" type="search" name="q" placeholder="Search..." aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </form>
</div>
<script>$('#searchbox').show(0);</script>

                    

<nav class="flex flex-col text-center">
    <a class="text-green-600 py-1 border-t text-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-900" href="/blog">Blog</a>
    <a class="text-green-600 py-1 border-t text-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-900" href="/code">Code</a>
    <a class="text-green-600 py-1 border-t text-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-900" href="/notes">Notes</a>
</nav>

                    <div class="flex-shrink overflow-auto">

<div class="grid justify-between p-4 text-gray-400 border-t dark:border-gray-600" style="grid-template-columns: 24px auto">
    
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
</svg>
    <span class="ml-2 text-right">Jan 08, 2020</span>
    

    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
</svg>
    <ul class="text-right">
        
        <li class="mb-1">
            <a href="../../tag/c/" class="px-2 my-1 text-green-600 border border-green-600 rounded bg-green-50 dark:bg-green-900 dark:text-green-200">
                #c
            </a>
        </li>
        
        <li class="mb-1">
            <a href="../../tag/graphics/" class="px-2 my-1 text-green-600 border border-green-600 rounded bg-green-50 dark:bg-green-900 dark:text-green-200">
                #graphics
            </a>
        </li>
        
        <li class="mb-1">
            <a href="../../tag/vulkan/" class="px-2 my-1 text-green-600 border border-green-600 rounded bg-green-50 dark:bg-green-900 dark:text-green-200">
                #vulkan
            </a>
        </li>
        
    </ul>
</div>
<nav id="localtoc" class="p-4 border-t dark:text-gray-200 dark:border-gray-600">
    <ul>
<li><a class="reference internal" href="#">Learning Vulkan: Enumerating Physical Devices</a><ul>
<li><a class="reference internal" href="#setup">Setup</a><ul>
<li><a class="reference internal" href="#project-structure">Project Structure</a></li>
<li><a class="reference internal" href="#the-makefile">The Makefile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-an-instance">Creating an instance</a></li>
<li><a class="reference internal" href="#listing-devices">Listing Devices</a></li>
<li><a class="reference internal" href="#device-properties">Device Properties</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

</nav>
                    </div>

                    <footer class="w-full p-4 mt-auto text-white bg-gray-700">
                        <div class="flex justify-between">
    <div></div>

    <div class="flex justify-between space-x-4">
        <a target="_blank" rel="noreferrer noopener" href="https://github.com/alcarney">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg>
        </a>

        <a target="_blank" rel="noreferrer noopener" href="https://twitter.com/alcarneyme">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
            </svg>
        </a>

        <a target="_blank" rel="noreferrer noopener" href="https://instagram.com/alcarneyme">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
            </svg>
        </a>

        <a target="_blank" rel="noreferrer noopener" href="https://www.youtube.com/channel/UC5GPflgRWhnCxA0BllfP5CA">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path>
                <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
            </svg>
        </a>
    </div>

    <div></div>
</div>
                    </footer>
                </div>
            </div>
        </aside>

        <main class="w-full mx-auto lg:pr-0">
            <div class="sticky top-0 z-50 mt-0 transition-all duration-300 bg-white dark:bg-gray-800 border-b shadow-md lg:shadow-none lg:relative lg:-mt-16 dark:border-gray-600">
                <label class="flex h-16 text-gray-600 transition" for="menu-state">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-8 h-8 my-auto" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </label>
            </div>

            <div id="content" class="mx-2 my-8">
                <div role="main" class="max-w-3xl mx-auto">
                    

<article class="p-4 prose-sm prose bg-white dark:bg-gray-800 border prose-md prose-emerald max-w-none dark:prose-invert dark:border-gray-600">
    <section id="learning-vulkan-enumerating-physical-devices">
<h1>Learning Vulkan: Enumerating Physical Devices<a class="headerlink" href="#learning-vulkan-enumerating-physical-devices" title="Permalink to this headline">¬∂</a></h1>
<p>Being an API for talking to GPUs and other compute devices every Vulkan
program starts off by looking for an appropriate <a class="reference external" href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/man/html/VkPhysicalDevice.html">physical device</a>
to use. In this post I write a little C program that initialises the Vulkan
API and lists out the available devices in the system.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ vkdevice
Device Name:            Intel(R) HD Graphics 520 (Skylake GT2)
  Type:                 Integrated GPU
  Vendor ID:            32902
  Device ID:            6422
  API Version:          v1.1.102
  Driver Version:       v19.3.1
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is part of my ‚ÄúLearning Vulkan‚Äù series where I try to figure how to use
Vulkan to explore various concepts in graphics programming. As mentioned in
the <a class="reference internal" href="../learning-vulkan-p0/"><span class="doc">Overview</span></a> I don‚Äôt necessarily
know what I‚Äôm doing!</p>
</div>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¬∂</a></h2>
<p>Unlike Python which has tools like <code class="docutils literal notranslate"><span class="pre">pip</span></code> and <code class="docutils literal notranslate"><span class="pre">venv</span></code> to manage
dependencies and development environments, C projects (as far as I know)
require the environment of your development machine to be ‚Äújust right‚Äù. This means
details such as the host operating system and its libraries are more important
than normal.</p>
<p>Since this series is a learning exercise, being able to compile and run code
across multiple systems is not a huge concern of mine right now. But here is a rough
overview of what is required to build this project‚Ä¶</p>
<p>I‚Äôm running Arch Linux with <code class="docutils literal notranslate"><span class="pre">gcc</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span></code> installed along with the following
Vulkan related packages</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pacman -Q <span class="p">|</span> grep vulkan
<span class="go">vulkan-extra-layers 1.1.130+10614+a70d5d17e-1</span>
<span class="go">vulkan-headers 1:1.1.130-1</span>
<span class="go">vulkan-html-docs 1:1.1.130-1</span>
<span class="go">vulkan-icd-loader 1.1.130-1</span>
<span class="go">vulkan-intel 19.3.1-1</span>
<span class="go">vulkan-man-pages 1:1.0.38-1</span>
<span class="go">vulkan-trace 1.1.130+10614+a70d5d17e-1</span>
<span class="go">vulkan-validation-layers 1.1.130-1</span>
</pre></div>
</div>
<p>I‚Äôm not sure however which of these are essential for the code contained in this
post.</p>
<section id="project-structure">
<h3>Project Structure<a class="headerlink" href="#project-structure" title="Permalink to this headline">¬∂</a></h3>
<p>I‚Äôm intending over the course of this series to build up a repository of Vulkan
examples/utilities and since the API  has a reputation of being verbose I‚Äôll be looking
to reuse as much code as I can! So with that in mind I have opted for the following
project structure</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>tree -a --dirsfirst
<span class="go">.</span>
<span class="go">‚îú‚îÄ‚îÄ bin</span>
<span class="go">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ vkdevice</span>
<span class="go">‚îú‚îÄ‚îÄ src</span>
<span class="go">‚îÇ¬†¬† ‚îú‚îÄ‚îÄ vkdevice.c</span>
<span class="go">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ vkdevice.o</span>
<span class="go">‚îú‚îÄ‚îÄ .gitignore</span>
<span class="go">‚îî‚îÄ‚îÄ Makefile</span>
</pre></div>
</div>
<p>Nothing ground breaking, a <code class="docutils literal notranslate"><span class="pre">src/</span></code> folder to hold the source and intermediate build files,
<code class="docutils literal notranslate"><span class="pre">bin/</span></code> to hold all the compiled programs and a plain <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> to orchestrate the whole
thing.</p>
</section>
<section id="the-makefile">
<h3>The Makefile<a class="headerlink" href="#the-makefile" title="Permalink to this headline">¬∂</a></h3>
<p>I know that there are tools such as <a class="reference external" href="https://cmake.org/">CMake</a> and <a class="reference external" href="https://www.gnu.org/software/autoconf/">Autoconf</a> that are
probably preferable to a plain Makefile since they can be used to abstract over some
differences between platforms. However since I‚Äôm not familiar with them and want to
focus on learning Vulkan I‚Äôm opting for a simpler approach to start out with.</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">=</span> -Wall -Wextra
<span class="nv">LDFLAGS</span> <span class="o">=</span> -lvulkan
</pre></div>
</div>
<p>Here I‚Äôm declaring that I‚Äôm using the <code class="docutils literal notranslate"><span class="pre">gcc</span></code> compiler, the <code class="docutils literal notranslate"><span class="pre">CFLAGS</span></code> variable contains any
flags that should passed to compile steps (at the moment this just enables some compiler
warnings). Finally <code class="docutils literal notranslate"><span class="pre">LDFLAGS</span></code> contains any flags related to linking, <code class="docutils literal notranslate"><span class="pre">-lvulkan</span></code> tells the
linker to link our program against the Vulkan SDK.</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">default</span> <span class="n">clean</span>
<span class="nf">default</span><span class="o">:</span> <span class="n">vkdevice</span>
<span class="nf">clean</span><span class="o">:</span>
   rm src/*.o bin/*
</pre></div>
</div>
<p>Next I define the <code class="docutils literal notranslate"><span class="pre">default</span></code> target to be <code class="docutils literal notranslate"><span class="pre">vkdevice</span></code> so that I can just run <code class="docutils literal notranslate"><span class="pre">make</span></code> and
have it build the project. Then there‚Äôs a <code class="docutils literal notranslate"><span class="pre">clean</span></code> target so that it‚Äôs easy to recompile
everything from scratch. Declaring both <code class="docutils literal notranslate"><span class="pre">default</span></code> and <code class="docutils literal notranslate"><span class="pre">clean</span></code> to be <a class="reference external" href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets">phony targets</a> I
think means we‚Äôre telling <code class="docutils literal notranslate"><span class="pre">make</span></code> not to look for matching files on the filesystem.</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nf">%.o</span><span class="o">:</span> %.<span class="n">c</span>
   <span class="k">$(</span>CC<span class="k">)</span> -c <span class="k">$(</span>CFLAGS<span class="k">)</span> $&lt; <span class="nv">$@</span>

<span class="nv">VKDEVICE</span> <span class="o">=</span> src/vkdevice.o
<span class="nf">vkdevice</span><span class="o">:</span>
   <span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>LDFLAGS<span class="k">)</span> <span class="k">$(</span>VKDEVICE<span class="k">)</span> -o bin/vkdevice
</pre></div>
</div>
<p>Last but not least we get to the main part of the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. First there is a generic
<a class="reference external" href="https://www.gnu.org/software/make/manual/make.html#Pattern-Rules">pattern rule</a> that instructs <code class="docutils literal notranslate"><span class="pre">make</span></code> on how to convert any <code class="docutils literal notranslate"><span class="pre">.c</span></code> file into
an <code class="docutils literal notranslate"><span class="pre">.o</span></code> file making use of any of the compiler flags defined earlier. This allows the
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code> to be extended to compile each program we write by declaring a target that
links the relevant object files (as defined by <code class="docutils literal notranslate"><span class="pre">VKDEVICE</span></code>) into an executable.</p>
<p>Then we can compile the project by calling <code class="docutils literal notranslate"><span class="pre">make</span></code> from the same directory as the
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>make
<span class="go">gcc -c -Wall -Wextra src/vkdevice.c -o src/vkdevice.o</span>
<span class="go">gcc -lvulkan src/vkdevice.o -o bin/vkdevice</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-an-instance">
<h2>Creating an instance<a class="headerlink" href="#creating-an-instance" title="Permalink to this headline">¬∂</a></h2>
<p>With all the housekeeping out of the way, time to dive into the code which starts in
a fairly standard way with us including all the header files we need.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vulkan/vulkan.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">// Insert code...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Then we start by filling out the <code class="docutils literal notranslate"><span class="pre">VkApplicationInfo</span></code> and <code class="docutils literal notranslate"><span class="pre">VkInstanceCreateInfo</span></code> structs.
Unsurprisingly the first is used to provide information about our application such as
the version of the API we wish to use. The application name and version fields are
arbitrary and can be set to whatever we like.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">VkApplicationInfo</span><span class="w"> </span><span class="n">app_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_APPLICATION_INFO</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="p">.</span><span class="n">pApplicationName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;vkDevice Info&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="p">.</span><span class="n">applicationVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_MAKE_VERSION</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">   </span><span class="p">.</span><span class="n">apiVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_API_VERSION_1_1</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="n">VkInstanceCreateInfo</span><span class="w"> </span><span class="n">vk_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="p">.</span><span class="n">pApplicationInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">app_info</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">vk_info</span></code> struct is then be used to create the instance.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">VkInstance</span><span class="w"> </span><span class="n">vk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>
<span class="n">VkResult</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vkCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vk_info</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vk</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">VK_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Unable to create VkInstance!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>We also have to be sure to destroy the instance once we have finished with it</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Code omitted...</span>

<span class="nl">cleanup_instance</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="n">vkDestroyInstance</span><span class="p">(</span><span class="n">vk</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>

<span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>This is me attempting to apply <a class="reference external" href="https://www.kernel.org/doc/html/v4.10/process/coding-style.html#centralized-exiting-of-functions">this</a> rule from the Linux kernel style
guide to help manage resources through the lifetime of the program.</p>
</section>
<section id="listing-devices">
<h2>Listing Devices<a class="headerlink" href="#listing-devices" title="Permalink to this headline">¬∂</a></h2>
<p>Now that we have an instance we can start querying the API for the physical devices that
are in the system. The issue is however - we don‚Äôt know how many devices the system has!
To get around this we first have to call <code class="docutils literal notranslate"><span class="pre">vkEnumeratePhysicalDevices</span></code> with a <code class="docutils literal notranslate"><span class="pre">NULL</span></code>
pointer, it will then mutate the <cite>count</cite> variable that we give to be equal to the number
of available devices.</p>
<p>Note that we skip straight to the <code class="docutils literal notranslate"><span class="pre">cleanup_instance</span></code> label we defined earlier if this
step fails.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">vk</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">VK_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Unable to enumerate physical devices</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">goto</span><span class="w"> </span><span class="n">cleanup_instance</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Next we attempt to allocate enough memory to store each of the devices in an array.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">VkPhysicalDevice</span><span class="o">*</span><span class="w"> </span><span class="n">physical_devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">VkPhysicalDevice</span><span class="p">));</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">physical_devices</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Unable to enumerate physical devices</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">goto</span><span class="w"> </span><span class="n">cleanup_instance</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Finally with the array allocated we can call <code class="docutils literal notranslate"><span class="pre">vkEnumeratePhysicalDevices</span></code> a second time
to populate it. Notice how this time the error path has to jump to the <code class="docutils literal notranslate"><span class="pre">cleanup_devices</span></code>
label so that we can be sure to <code class="docutils literal notranslate"><span class="pre">free</span></code> the newly allocated memory.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">vk</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">physical_devices</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">VK_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Unable to enumerate physical devices</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">goto</span><span class="w"> </span><span class="n">cleanup_devices</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Code omitted...</span>

<span class="nl">cleanup_devices</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="n">free</span><span class="p">(</span><span class="n">physical_devices</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">physical_devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>

<span class="nl">cleanup_instance</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="n">vkDestroyInstance</span><span class="p">(</span><span class="n">vk</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition-editor-s-note admonition">
<p class="admonition-title">Editor‚Äôs Note</p>
<p>As I was writing this post I looked up the <a class="reference external" href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/man/html/vkEnumeratePhysicalDevices.html">documentation</a>
for <code class="docutils literal notranslate"><span class="pre">vkEnumeratePhysicalDevices</span></code> and noticed that there is a different way to
approach this section. We could‚Äôve instead decided on a fixed size array</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">MAX_DEVICES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="n">VkPhysicalDevice</span><span class="w"> </span><span class="n">physical_devices</span><span class="p">[</span><span class="n">MAX_DEVICES</span><span class="p">];</span><span class="w"></span>
<span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">vk</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">MAX_DEVICES</span><span class="p">,</span><span class="w"> </span><span class="n">physical_devices</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>In this situation the function will return up to <code class="docutils literal notranslate"><span class="pre">MAX_DEVICES</span></code> and if there more
devices than can fit in the array then <code class="docutils literal notranslate"><span class="pre">res</span></code> will be set to <code class="docutils literal notranslate"><span class="pre">VK_INCOMPLETE</span></code> giving
us the option to try again with a larger array.</p>
<p>This creates a dilemma - which approach is better? ü§î</p>
</div>
</section>
<section id="device-properties">
<h2>Device Properties<a class="headerlink" href="#device-properties" title="Permalink to this headline">¬∂</a></h2>
<p>It turns out that a <code class="docutils literal notranslate"><span class="pre">VkPhysicalDevice</span></code> on its own is rather useless since it doesn‚Äôt
carry any information about itself. In order to find out more about what the device is
and what features of the API it supports you need to call additional functions such as</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/man/html/vkGetPhysicalDeviceProperties.html">vkGetPhysicalDeviceProperties</a></p></li>
<li><p><a class="reference external" href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/man/html/vkGetPhysicalDeviceImageFormatProperties.html">vkGetPhysicalDeviceImageFormatProperties</a></p></li>
<li><p><a class="reference external" href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/man/html/vkGetPhysicalDeviceQueueFamilyProperties.html">vkGetPhysicalDeviceQueueFamilyProperties</a></p></li>
<li><p>and many more!!</p></li>
</ul>
<p>Typically as part of your program‚Äôs setup you would call a number of these to gather
information about support for features that matter to you to help decide which device
is best suited to your use case. However for this toy program we‚Äôre only going to call
<code class="docutils literal notranslate"><span class="pre">vkGetPhysicalDeviceProperties</span></code> for each device which will give us information such as
its name.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">VkPhysicalDeviceProperties</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="w">   </span><span class="n">vkGetPhysicalDeviceProperties</span><span class="p">(</span><span class="n">physical_devices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">properties</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Version numbers (<code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.PATCH</span></code>) in the Vulkan API are encoded into a single 32bit
integer as defined in the <a class="reference external" href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/html/vkspec.html#extendingvulkan-coreversions-versionnumbers">specification</a>. Thankfully the spec also defines a number of
macros that make decoding them nice and easy for us.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">vk_major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_VERSION_MAJOR</span><span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="n">apiVersion</span><span class="p">);</span><span class="w"></span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">vk_minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_VERSION_MINOR</span><span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="n">apiVersion</span><span class="p">);</span><span class="w"></span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">vk_patch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_VERSION_PATCH</span><span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="n">apiVersion</span><span class="p">);</span><span class="w"></span>

<span class="kt">uint32_t</span><span class="w"> </span><span class="n">driver_major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_VERSION_MAJOR</span><span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="n">driverVersion</span><span class="p">);</span><span class="w"></span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">driver_minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_VERSION_MINOR</span><span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="n">driverVersion</span><span class="p">);</span><span class="w"></span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">driver_patch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VK_VERSION_PATCH</span><span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="n">driverVersion</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>All that‚Äôs left to do is to print out the information we have gathered.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Device Name:     </span><span class="se">\t</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">.</span><span class="n">deviceName</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  Type:          </span><span class="se">\t</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vkPhysicalDeviceType_as_string</span><span class="p">(</span><span class="n">properties</span><span class="p">.</span><span class="n">deviceType</span><span class="p">));</span><span class="w"></span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  Vendor ID:     </span><span class="se">\t</span><span class="s">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">.</span><span class="n">vendorID</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  Device ID:     </span><span class="se">\t</span><span class="s">%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">.</span><span class="n">deviceID</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  API Version:   </span><span class="se">\t</span><span class="s">v%d.%d.%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vk_major</span><span class="p">,</span><span class="w"> </span><span class="n">vk_minor</span><span class="p">,</span><span class="w"> </span><span class="n">vk_patch</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  Driver Version:</span><span class="se">\t</span><span class="s">v%d.%d.%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">driver_major</span><span class="p">,</span><span class="w"> </span><span class="n">driver_minor</span><span class="p">,</span><span class="w"> </span><span class="n">driver_patch</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>I should also note that <code class="docutils literal notranslate"><span class="pre">vkPhysicalDeviceType_as_string</span></code> is a helper function I
defined that converts a member of the <a class="reference external" href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/man/html/VkPhysicalDeviceType.html">VkPhysicalDeviceType</a> enum
into a string representation with a <code class="docutils literal notranslate"><span class="pre">switch</span></code> statement.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¬∂</a></h2>
<p>And that‚Äôs that! I‚Äôve taken my first few baby steps with the Vulkan API and I hope that
if you‚Äôve read this far then this post was as useful to you as it was to me! If you are
interested then you can see the full code listing <a class="reference external" href="https://github.com/alcarney/vk/blob/2e7daaa68d79c6467e91bbd9d5ebfcf34729f6a5/src/vkdevice.c">here</a> and I‚Äôll see you in the
next one.</p>
</section>
</section>

</article>




<div class="mt-8 pt-4 border-t dark:border-gray-600">
    <script src="https://giscus.app/client.js"
            data-repo="alcarney/blog"
            data-repo-id="MDEwOlJlcG9zaXRvcnk2Njk3NzM3MQ=="
            data-category="Comments"
            data-category-id="DIC_kwDOA_3-W84B_XOl"
            data-mapping="pathname"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-theme="preferred_color_scheme"
            crossorigin="anonymous"
            async>
    </script>
</div>



                </div>
            </div>

            <footer class="p-2 mt-8 mb-2 text-sm text-gray-600 border-t dark:border-gray-600">
                <div class="flex flex-col justify-between max-w-3xl mx-auto lg:flex-row">
                    <span>
                        <a class="text-green-600" href="../../../_sources/blog/2020/learning-vulkan-p1.rst.txt" rel="nofollow">
                            Page Source
                        </a>
                    </span>
                    <span>Built with <a class="text-green-600" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> v4.5.0</span>
                    <span>&#169; Copyright 2021, Alex Carney.</span>
                </div>
            </footer>
        </main>

    </div>
<script src="/_static/js/theme.js"></script>


  </body>
</html>